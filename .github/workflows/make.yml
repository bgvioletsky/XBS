name: make_xbs

on:
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v3

    - name: Set up Go
      uses: actions/setup-go@v4
      with:
        go-version: '1.22.5'

    - name: Build
      env:
        EMAIL: ${{ secrets.EMAIL }}
        USERNAME: ${{ secrets.NAME }}
      run: |
          go mod tidy && make
          echo "下面是用于解密的">> kk.txt
          # if [ ! -f version.txt ]; then
          #      echo "0.0.0" > version.txt
          #  fi
          #  VERSION=$(cat version.txt)
          #  IFS='.' read -r -a versionArray <<< "$VERSION"
          #  ((versionArray[2]++))

          #  # 检查并处理所有边界条件
          #  if [ "${versionArray[2]}" -eq 20 ]; then
          #      versionArray[2]=0
          #      ((versionArray[1]++))
          #  fi
          #  if [ "${versionArray[1]}" -eq 20 ]; then
          #      versionArray[1]=0
          #      ((versionArray[0]++))
          #  fi

          #  # 将新版本号写回到version.txt文件中
          #  NEW_VERSION="${versionArray[0]}.${versionArray[1]}.${versionArray[2]}"
          #  echo "$NEW_VERSION" > version.txt
           echo "version=mac_v0.0.1" >> $GITHUB_ENV

    # - name: commit
    #   env:
    #     EMAIL: ${{ secrets.EMAIL }}
    #     USERNAME: ${{ secrets.NAME }}
    #   run: |
    #       git config --local user.email "$EMAIL"
    #       git config --local user.name "$USERNAME"
    #       # 检查是否有更新
    #       git fetch --dry-run origin main || true
    #       git diff --quiet HEAD origin/main || (
    #         git pull --rebase
    #         git add version.txt
    #         # 使用自定义变量记录提交时间
    #         CURRENT_DATE=$(date +'%Y-%m-%d %H:%M:%S')
    #         git commit -m "update $CURRENT_DATE"
    #       )


    - name: 发布到release
      uses: softprops/action-gh-release@v1
      with:
        tag_name: ${{env.version}}
        body_path: ./kk.txt
        files: ./kk/*
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}